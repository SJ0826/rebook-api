<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Socket.IO í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
<h1>ğŸ“¡ Socket.IO í…ŒìŠ¤íŠ¸</h1>
<p>ìƒíƒœ: <span id="status">ì—°ê²°ë˜ì§€ ì•ŠìŒ âŒ</span></p>

<button onclick="connectSocket()">ğŸ”— ì„œë²„ ì—°ê²°</button>
<button onclick="disconnectSocket()">ğŸ”Œ ì—°ê²° ì¢…ë£Œ</button>

<h2>ì±„íŒ…ë°© ì…ì¥</h2>
<input id="chatRoomId" placeholder="ì±„íŒ…ë°© ID ì…ë ¥" type="number">
<button onclick="joinRoom()">ì…ì¥</button>

<h2>ë©”ì‹œì§€ ì „ì†¡</h2>
<input id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" type="text">
<button onclick="sendMessage()">ë³´ë‚´ê¸°</button>

<h2>ğŸ“© ë©”ì‹œì§€ ë¡œê·¸</h2>
<div id="chatLog" style="border:1px solid #ccc; padding:10px; height:200px; overflow:auto;"></div>

<script>
  let socket;

  function connectSocket() {
    socket = io('ws://localhost:3000/chat', { transports: ['websocket'] });

    socket.on('connect', () => {
      document.getElementById('status').innerText = `ì—°ê²°ë¨ âœ… (ID: ${socket.id})`;
      console.log('âœ… ì„œë²„ì™€ ì—°ê²°ë¨!', socket.id);
    });

    socket.on('disconnect', () => {
      document.getElementById('status').innerText = 'ì—°ê²° ëŠê¹€ âŒ';
      console.log('âŒ ì„œë²„ ì—°ê²° ì¢…ë£Œ');
    });

    // âœ… ê¸°ì¡´ ë©”ì‹œì§€ ë¶ˆëŸ¬ì˜¤ê¸°
    socket.on('loadMessages', (messages) => {
      console.log('ğŸ“© ê¸°ì¡´ ë©”ì‹œì§€:', messages);
      const chatLog = document.getElementById('chatLog');
      chatLog.innerHTML = ''; // ê¸°ì¡´ ë©”ì‹œì§€ ì´ˆê¸°í™”

      messages.forEach(msg => {
        chatLog.innerHTML += `<p>ğŸ“œ ${msg.content} (ë³´ë‚¸ ì‚¬ëŒ: ${msg.senderId})</p>`;
      });
    });

    // âœ… ì‹¤ì‹œê°„ ë©”ì‹œì§€ ìˆ˜ì‹ 
    socket.on('newMessage', (message) => {
      console.log('ğŸ“© ìƒˆ ë©”ì‹œì§€:', message);
      document.getElementById('chatLog').innerHTML += `<p>ğŸ“© ${message.content} (ë³´ë‚¸ ì‚¬ëŒ: ${message.senderId})</p>`;
    });
  }

  function disconnectSocket() {
    if (socket) {
      socket.disconnect();
      console.log('ğŸ”Œ ì„œë²„ ì—°ê²° ì¢…ë£Œë¨');
    }
  }

  function joinRoom() {
    const chatRoomId = document.getElementById('chatRoomId').value;
    if (!chatRoomId) {
      alert('ì±„íŒ…ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
      return;
    }

    socket.emit('joinRoom', { chatRoomId: Number(chatRoomId) });
    console.log(`ğŸšª ì±„íŒ…ë°© ${chatRoomId}ì— ì…ì¥ ìš”ì²­`);
  }

  function sendMessage() {
    const chatRoomId = document.getElementById('chatRoomId').value;
    const message = document.getElementById('messageInput').value;
    if (!chatRoomId || !message) {
      alert('ì±„íŒ…ë°© IDì™€ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
      return;
    }

    socket.emit('message', {
      chatRoomId: Number(chatRoomId),
      senderId: 1, // í…ŒìŠ¤íŠ¸ìš© ID
      content: message,
    });

    console.log('âœ‰ï¸ ë©”ì‹œì§€ ì „ì†¡:', message);
    document.getElementById('chatLog').innerHTML += `<p>âœ‰ï¸ ë‚˜: ${message}</p>`;
  }
</script>
</body>
</html>